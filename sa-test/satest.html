<!DOCTYPE HTML>
<html>
  <head>
    <title>RAIL Lab: Situational Awareness Test (by Jack Kolb)</title>
    <style>
      canvas{
        border: 2px solid black;
        background-color: white;
      }
    </style>
    <meta charset="UTF-8">
  </head>
  <!-- PULLED ON NOVEMBER 18 -->
  <!-- COPYRIGHTED (C) 2020, RAIL Lab @ Georgia Tech -->

  <link rel="stylesheet" href="styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100&display=swap" rel="stylesheet"> 
  
  <script src="./sagat.js"></script>
  <script src="./motion.js"></script>
  <script src="./shapes.js"></script>
  <script src="./utility.js"></script>
  <script src="./sidePanel.js"></script>
  <script src="./gameObjects/gameboard.js"></script>
  <script src="./gameObjects/package.js"></script>
  <script src="./gameObjects/spawner.js"></script>
  <script src="./gameObjects/warehouse.js"></script>
  
  <body>
    <div class="center-div">
      <h1>RAIL Lab Situational Awareness Test</h1>
      <div style="display: flex;">
        <canvas id="Canvas" class="stage" width="1200" height="800"></canvas>
        <div id="SidePanel" class="side-panel">
          <div id="SidePanelTitle" style="text-decoration: underline; text-align: center;"></div>
          <div id="SidePanelContent"></div>
          <br>
          <div style="display:flex; flex-direction: column; justify-content: center">
            <input id="gtid-input" type="text"></input>
            <button id="sagat-resume" class="resume" onclick="sagat.unfreeze();">Resume</button>
          </div>
        </div>
      </div>
    </div>

    <script>
      var seed = xmur3("RAIL Lab");  // use xmur3 to create a seed hash
      var rand = mulberry32(seed());  // use the mulberry32 algorithm for the random number generator
      
      var stage = document.getElementById("Canvas");  // the gameboard stage (for drawing)
      var context = stage.getContext("2d");  // the gameboard context (for drawing)

      var tutorialActive = true;
      var gameActive = false;
      
      var gtid = "";

      // initialize the GT ID text field
      document.getElementById("gtid-input").onchange = function () {
        gtid = "GTID" + document.getElementById("gtid-input").value;
      }

      // initialize lists used to keep track of things
      var packages = [];  // active packages
      var warehouses = [];  // active warehouses
      var spawners = [];  // active spawners

      // initialize the gameboard
      var gameboard = new Gameboard(context);
      gameboard.generateTutorialGameboard();

      // initialize the SAGAT test
      var sagat = new SAGAT(20);  // the argument is the freeze period

      // set the side panel to the introduction
      sidePanelTutorial1();

      window.addEventListener("mousedown", mouseHandler);

      // main game loop
      function updateBoard() {
        context.clearRect(0, 0, stage.width, stage.height);  // clear the gameboard
        gameboard.draw(sagat.active);  // draw the gameboard
        if (gameActive) {  // only run if the game is active
          sagat.timestep();
          
          if (!sagat.active) {  // if the board isn't frozen, update the packages
            movePackages(packages);  // move and draw the packages 
            updateWarehouses(warehouses);  // update the warehouses
            updateSpawners(spawners, packages);  // update the spawners
          }
        }
        window.requestAnimationFrame(updateBoard);
      }
      window.requestAnimationFrame(updateBoard);
                           
    </script>
  </body>
</html>
